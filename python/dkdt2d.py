import numpy as np
def dkdt2d(Ex,Ey,nuxy,nuyz,Gxy,T,V):
    c2 = np.cos(2*T)
    c4 = np.cos(4*T)
    s2 = np.sin(2*T)
    s4 = np.sin(4*T)
    dkdt = np.zeros((8,8))
    dkdt[0][0] = (3*Ex**2*c2 + 3*Ex**2*c4 - 4*Ex**2*s2 - 3*Ex*Ey*c2 + 3*Ex*Ey*c4 - 12*Ex*Gxy*c4 + 4*Ex*Ey*s2 - 6*Ex*Ey*nuxy*c4 + 12*Ey*Gxy*nuxy**2*c4)/(12*Ex - 12*Ey*nuxy**2)
    dkdt[0][1] = (Ex*(8*Ex*c2 - 8*Ey*c2 + 6*Ex*s4 + 6*Ey*s4 - 12*Ey*nuxy*s4))/(24*Ex - 24*Ey*nuxy**2) - Gxy*s4
    dkdt[0][2] = (4*Ex**2*s2 + 3*Ex**2*s4 - 4*Ex*Ey*s2 + 3*Ex*Ey*s4 - 12*Ex*Gxy*s4 + 12*Ey*Gxy*nuxy**2*s4 - 6*Ex*Ey*nuxy*s4)/(12*Ex - 12*Ey*nuxy**2)
    dkdt[0][3] = -(4*Ex**2*c2 + 12*Ex**2*c4 - 4*Ex*Ey*c2 + 12*Ex*Ey*c4 - 48*Ex*Gxy*c4 - 24*Ex*Ey*nuxy*c4 + 48*Ey*Gxy*nuxy**2*c4)/(48*(Ex - Ey*nuxy**2))
    dkdt[0][4] = -(3*Ex**2*c2 + 3*Ex**2*c4 - 2*Ex**2*s2 - 3*Ex*Ey*c2 + 3*Ex*Ey*c4 - 12*Ex*Gxy*c4 + 2*Ex*Ey*s2 - 6*Ex*Ey*nuxy*c4 + 12*Ey*Gxy*nuxy**2*c4)/(12*Ex - 12*Ey*nuxy**2)
    dkdt[0][5] = Gxy*s4 - (Ex*(4*Ex*c2 - 4*Ey*c2 + 6*Ex*s4 + 6*Ey*s4 - 12*Ey*nuxy*s4))/(24*Ex - 24*Ey*nuxy**2)
    dkdt[0][6] = -(2*Ex**2*s2 + 3*Ex**2*s4 - 2*Ex*Ey*s2 + 3*Ex*Ey*s4 - 12*Ex*Gxy*s4 + 12*Ey*Gxy*nuxy**2*s4 - 6*Ex*Ey*nuxy*s4)/(12*Ex - 12*Ey*nuxy**2)
    dkdt[0][7] = (12*Ex**2*c4 - 4*Ex**2*c2 + 4*Ex*Ey*c2 + 12*Ex*Ey*c4 - 48*Ex*Gxy*c4 - 24*Ex*Ey*nuxy*c4 + 48*Ey*Gxy*nuxy**2*c4)/(48*(Ex - Ey*nuxy**2))
    dkdt[1][1] = -(3*Ex**2*c4 - 3*Ex**2*c2 - 4*Ex**2*s2 + 3*Ex*Ey*c2 + 3*Ex*Ey*c4 - 12*Ex*Gxy*c4 + 4*Ex*Ey*s2 - 6*Ex*Ey*nuxy*c4 + 12*Ey*Gxy*nuxy**2*c4)/(12*Ex - 12*Ey*nuxy**2)
    dkdt[1][2] = dkdt[0][3]
    dkdt[1][3] = -(3*Ex**2*s4 - 2*Ex**2*s2 + 2*Ex*Ey*s2 + 3*Ex*Ey*s4 - 12*Ex*Gxy*s4 + 12*Ey*Gxy*nuxy**2*s4 - 6*Ex*Ey*nuxy*s4)/(12*Ex - 12*Ey*nuxy**2)
    dkdt[1][4] = dkdt[0][5]
    dkdt[1][5] = (3*Ex**2*c4 - 3*Ex**2*c2 - 2*Ex**2*s2 + 3*Ex*Ey*c2 + 3*Ex*Ey*c4 - 12*Ex*Gxy*c4 + 2*Ex*Ey*s2 - 6*Ex*Ey*nuxy*c4 + 12*Ey*Gxy*nuxy**2*c4)/(12*Ex - 12*Ey*nuxy**2)
    dkdt[1][6] = dkdt[0][7]
    dkdt[1][7] = (3*Ex**2*s4 - 4*Ex**2*s2 + 4*Ex*Ey*s2 + 3*Ex*Ey*s4 - 12*Ex*Gxy*s4 + 12*Ey*Gxy*nuxy**2*s4 - 6*Ex*Ey*nuxy*s4)/(12*Ex - 12*Ey*nuxy**2)
    dkdt[2][2] = -(3*Ex**2*c2 + 3*Ex**2*c4 + 4*Ex**2*s2 - 3*Ex*Ey*c2 + 3*Ex*Ey*c4 - 12*Ex*Gxy*c4 - 4*Ex*Ey*s2 - 6*Ex*Ey*nuxy*c4 + 12*Ey*Gxy*nuxy**2*c4)/(12*Ex - 12*Ey*nuxy**2)
    dkdt[2][3] = Gxy*s4 - (Ex*(8*Ey*c2 - 8*Ex*c2 + 6*Ex*s4 + 6*Ey*s4 - 12*Ey*nuxy*s4))/(24*Ex - 24*Ey*nuxy**2)
    dkdt[2][4] = dkdt[0][6]
    dkdt[2][5] = dkdt[0][7]
    dkdt[2][6] = (3*Ex**2*c2 + 3*Ex**2*c4 + 2*Ex**2*s2 - 3*Ex*Ey*c2 + 3*Ex*Ey*c4 - 12*Ex*Gxy*c4 - 2*Ex*Ey*s2 - 6*Ex*Ey*nuxy*c4 + 12*Ey*Gxy*nuxy**2*c4)/(12*Ex - 12*Ey*nuxy**2)
    dkdt[2][7] = (Ex*(4*Ey*c2 - 4*Ex*c2 + 6*Ex*s4 + 6*Ey*s4 - 12*Ey*nuxy*s4))/(24*Ex - 24*Ey*nuxy**2) - Gxy*s4
    dkdt[3][3] = (3*Ex**2*c4 - 3*Ex**2*c2 + 4*Ex**2*s2 + 3*Ex*Ey*c2 + 3*Ex*Ey*c4 - 12*Ex*Gxy*c4 - 4*Ex*Ey*s2 - 6*Ex*Ey*nuxy*c4 + 12*Ey*Gxy*nuxy**2*c4)/(12*Ex - 12*Ey*nuxy**2)
    dkdt[3][4] = dkdt[0][7]
    dkdt[3][5] = dkdt[1][7]
    dkdt[3][6] = dkdt[2][7]
    dkdt[3][7] = -(3*Ex**2*c4 - 3*Ex**2*c2 + 2*Ex**2*s2 + 3*Ex*Ey*c2 + 3*Ex*Ey*c4 - 12*Ex*Gxy*c4 - 2*Ex*Ey*s2 - 6*Ex*Ey*nuxy*c4 + 12*Ey*Gxy*nuxy**2*c4)/(12*Ex - 12*Ey*nuxy**2)
    dkdt[4][4] = dkdt[0][0]
    dkdt[4][5] = dkdt[0][1]
    dkdt[4][6] = dkdt[0][2]
    dkdt[4][7] = dkdt[0][3]
    dkdt[5][5] = dkdt[1][1]
    dkdt[5][6] = dkdt[0][3]
    dkdt[5][7] = dkdt[1][3]
    dkdt[6][6] = dkdt[2][2]
    dkdt[6][7] = dkdt[2][3]
    dkdt[7][7] = dkdt[3][3]
    dkdt += dkdt.T - np.diag(dkdt.diagonal())
    dkdt *= V
    return dkdt